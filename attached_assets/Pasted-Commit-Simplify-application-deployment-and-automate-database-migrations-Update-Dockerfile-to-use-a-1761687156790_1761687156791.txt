Commit: Simplify application deployment and automate database migrations

Update Dockerfile to use a startup script that handles automatic database migrations before starting the application, and streamline deployment instructions for Easypanel.

Replit-Commit-Author: Agent
Replit-Commit-Session-Id: 5ea36457-0e61-4a57-b199-434259371b0d
Replit-Commit-Checkpoint-Type: full_checkpoint
Replit-Commit-Screenshot-Url: https://storage.googleapis.com/screenshot-production-us-central1/2e643b99-2317-4d0e-9ba1-831b9fb70e4b/5ea36457-0e61-4a57-b199-434259371b0d/hRXYKHm 
##########################################
### Download Github Archive Started...
### Tue, 28 Oct 2025 21:30:35 GMT
##########################################

#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 866B 0.0s done
#1 DONE 0.1s

#2 [internal] load metadata for docker.io/library/node:20-alpine
#2 DONE 1.7s

#3 [internal] load .dockerignore
#3 transferring context: 188B done
#3 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 689.17kB 0.0s done
#4 DONE 0.0s

#5 [builder 1/6] FROM docker.io/library/node:20-alpine@sha256:6178e78b972f79c335df281f4b7674a2d85071aae2af020ffa39f0a770265435
#5 resolve docker.io/library/node:20-alpine@sha256:6178e78b972f79c335df281f4b7674a2d85071aae2af020ffa39f0a770265435 done
#5 sha256:e74e4ed823e9560b3fe51c0cab47dbfdfc4b12453604319408ec58708fb9e720 0B / 1.26MB 0.1s
#5 sha256:6178e78b972f79c335df281f4b7674a2d85071aae2af020ffa39f0a770265435 7.67kB / 7.67kB done
#5 sha256:be8d32d651b3e0c9c2b28fdc1d3888408125d703232013cff955344d052027e5 1.72kB / 1.72kB done
#5 sha256:2b56f2779663b9e1a77bdb5235dc31f1a81e534ccab1c1b35c716a8db79eeab9 6.42kB / 6.42kB done
#5 sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 0B / 3.80MB 0.1s
#5 sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 0B / 42.75MB 0.1s
#5 sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 3.80MB / 3.80MB 0.4s done
#5 extracting sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 0.1s
#5 sha256:da04d522c98fe12816b2bcddf8413fca73645f8fa60f287c672f58bcc7f0fa38 0B / 444B 0.4s
#5 sha256:e74e4ed823e9560b3fe51c0cab47dbfdfc4b12453604319408ec58708fb9e720 1.26MB / 1.26MB 0.5s done
#5 sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 3.15MB / 42.75MB 0.6s
#5 extracting sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 0.1s done
#5 sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 7.34MB / 42.75MB 0.7s
#5 sha256:da04d522c98fe12816b2bcddf8413fca73645f8fa60f287c672f58bcc7f0fa38 444B / 444B 0.7s done
#5 sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 11.53MB / 42.75MB 0.8s
#5 sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 22.02MB / 42.75MB 1.0s
#5 sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 28.31MB / 42.75MB 1.1s
#5 sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 37.75MB / 42.75MB 1.4s
#5 sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 42.75MB / 42.75MB 1.5s done
#5 extracting sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 0.1s
#5 extracting sha256:60e45a9660cfaebbbac9bba98180aa28b3966b7f2462d132c46f51a1f5b25a64 1.7s done
#5 extracting sha256:e74e4ed823e9560b3fe51c0cab47dbfdfc4b12453604319408ec58708fb9e720
#5 extracting sha256:e74e4ed823e9560b3fe51c0cab47dbfdfc4b12453604319408ec58708fb9e720 0.0s done
#5 extracting sha256:da04d522c98fe12816b2bcddf8413fca73645f8fa60f287c672f58bcc7f0fa38 done
#5 DONE 3.5s

#6 [builder 2/6] WORKDIR /app
#6 DONE 0.1s

#7 [builder 3/6] COPY package*.json ./
#7 DONE 0.0s

#8 [builder 4/6] RUN npm ci
#8 6.239 npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
#8 6.864 npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
#8 ...

#9 [stage-1  4/11] RUN npm ci --only=production
#9 0.217 npm warn config only Use `--omit=dev` to omit dev dependencies from the install.
#9 8.378 
#9 8.378 added 374 packages, and audited 375 packages in 8s
#9 8.378 
#9 8.378 52 packages are looking for funding
#9 8.378   run `npm fund` for details
#9 8.380 
#9 8.380 3 low severity vulnerabilities
#9 8.380 
#9 8.380 To address all issues, run:
#9 8.380   npm audit fix
#9 8.380 
#9 8.380 Run `npm audit` for details.
#9 8.381 npm notice
#9 8.381 npm notice New major version of npm available! 10.8.2 -> 11.6.2
#9 8.381 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#9 8.381 npm notice To update run: npm install -g npm@11.6.2
#9 8.381 npm notice
#9 DONE 8.9s

#8 [builder 4/6] RUN npm ci
#8 10.43 
#8 10.43 added 481 packages, and audited 482 packages in 10s
#8 10.43 
#8 10.43 64 packages are looking for funding
#8 10.43   run `npm fund` for details
#8 10.46 
#8 10.46 8 vulnerabilities (3 low, 5 moderate)
#8 10.46 
#8 10.46 To address issues that do not require attention, run:
#8 10.46   npm audit fix
#8 10.46 
#8 10.46 To address all issues (including breaking changes), run:
#8 10.46   npm audit fix --force
#8 10.46 
#8 10.46 Run `npm audit` for details.
#8 10.46 npm notice
#8 10.46 npm notice New major version of npm available! 10.8.2 -> 11.6.2
#8 10.46 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#8 10.46 npm notice To update run: npm install -g npm@11.6.2
#8 10.46 npm notice
#8 DONE 10.8s

#10 [builder 5/6] COPY . .
#10 DONE 0.0s

#11 [builder 6/6] RUN npm run build
#11 0.245 
#11 0.245 > rest-express@1.0.0 build
#11 0.245 > vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist
#11 0.245 
#11 0.496 vite v5.4.20 building for production...
#11 0.555 transforming...
#11 0.859 Browserslist: browsers data (caniuse-lite) is 12 months old. Please run:
#11 0.859   npx update-browserslist-db@latest
#11 0.859   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#11 1.745 
#11 1.745 A PostCSS plugin did not pass the `from` option to `postcss.parse`. This may cause imported assets to be incorrectly transformed. If you've recently added a PostCSS plugin that raised this warning, please contact the package author to fix the issue.
#11 5.117 ✓ 1757 modules transformed.
#11 5.748 rendering chunks...
#11 5.782 computing gzip size...
#11 5.812 
#11 5.812 (!) Some chunks are larger than 500 kB after minification. Consider:
#11 5.812 - Using dynamic import() to code-split the application
#11 5.812 - Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
#11 5.812 - Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
#11 5.813 ../dist/public/index.html                   0.95 kB │ gzip:   0.50 kB
#11 5.813 ../dist/public/assets/index-qYvQYbqs.css   72.25 kB │ gzip:  12.00 kB
#11 5.813 ../dist/public/assets/index-CE-xgYcl.js   561.39 kB │ gzip: 161.62 kB
#11 5.813 ✓ built in 5.29s
#11 5.978 
#11 5.978   dist/index.js  48.4kb
#11 5.978 
#11 5.978 ⚡ Done in 8ms
#11 DONE 6.0s

#12 [stage-1  5/11] COPY --from=builder /app/dist ./dist
#12 CACHED

#13 [stage-1  6/11] COPY --from=builder /app/client/dist ./client/dist
#13 ERROR: failed to calculate checksum of ref 4977954b-3be3-4ad3-b1b9-69b3e76f2f31::q5x6hg25at48mqerttec858es: "/app/client/dist": not found
------
 > [stage-1  6/11] COPY --from=builder /app/client/dist ./client/dist:
------
Dockerfile:31
--------------------
  29 |     # Copy built files from builder
  30 |     COPY --from=builder /app/dist ./dist
  31 | >>> COPY --from=builder /app/client/dist ./client/dist
  32 |     
  33 |     # Copy necessary files
--------------------
ERROR: failed to build: failed to solve: failed to compute cache key: failed to calculate checksum of ref 4977954b-3be3-4ad3-b1b9-69b3e76f2f31::q5x6hg25at48mqerttec858es: "/app/client/dist": not found
##########################################
### Error
### Tue, 28 Oct 2025 21:30:59 GMT
##########################################

Command failed with exit code 1: docker buildx build --network host -f /etc/easypanel/projects/server-geral/agenda-pro/code/Dockerfile -t easypanel/server-geral/agenda-pro --label 'keep=true' --build-arg 'DATABASE_URL=postgres://rafaelruch:9iAjD5s8MCEw@server-geral_agenda-pro-db:5432/dbagendapro?sslmode=disable' --build-arg 'SESSION_SECRET=rG0EEEwkq1RYDUqBHaZazhYbysJkKRhI' --build-arg 'NODE_ENV=production' --build-arg 'GIT_SHA=7d5b24f9399e19bf9eb2b3062f53f114b2bcddda' /etc/easypanel/projects/server-geral/agenda-pro/code/